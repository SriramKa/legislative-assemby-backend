# Sketching the URL structure

! prefixed URLs only accessible by authorised users.\
!! prefixed URLs give restricted access.

### Basic resource listing
```GET /``` displays whether you're logged in or not.

```GET /mla``` returns a list of MLA objects, but doesn't list the ```username```, ```password``` and ```eval``` fields.

###### Arguments:
- ```page``` takes integer value, to determine page number for pagination
- ```size``` takes integer value, to determines items per page for pagination.
- ```party``` takes in string value, to return the MLAs of the passed party.

**Q:** Would it be better to have an array of party members in each party object so not every MLA will be queried? **Update:** This has been implemented.

```GET /bills``` returns a list of Bills ever put forth in the Assembly or yet to be put forth, but doesn't list the ```supporting```, ```subscribers``` and ```presenter``` fields, because that makes sense in a political context.

###### Arguments:
- ```party``` takes string value, and returns all bills supported by the passed party. (Use the party object for this in the application logic)
- ```status``` takes string value and returns the bills which matches the passed status value
- ```show_all``` takes boolean value, if marked true, then displays all bills ever put forth in the assembly.
- ```show_mine``` takes boolean value, if marked true, gets all bills from the user's party.
- ```show_supported``` takes boolean value, if marked true, shows all bills that user's party supports.
- ```page``` takes integer value, to determine page number for pagination. Defaults to ```1```.
- ```size``` takes integer value, to determines items per page for pagination. Defaults to ```10```.

---

### User login and details
```GET /auth``` views instructions to login.

```POST /auth``` applies login logic with the entered details and logs in, redirecting to the ```/``` page.

```GET /auth/register``` views instructions to register.

```POST /auth/register``` takes user details JSON, applies registration logic and redirects to ```/auth``` to login with these new details.

**Q:** Would it even make sense to have ```/register``` to be a sub-handle from ```/auth```, although it makes semantic sense to have all authorisation under one common URL?

```!GET /auth/logout``` removes the authorization of a logged in user and redirects to ```/```

```!GET /user``` displays logged-in user's details.

###### Arguments:
- ```presented``` takes boolean value, if it's marked true, the array of the bills presented by this user is displayed.

```!POST /user/change```

###### Arguments:
- ```to-change``` takes string value, containing the fields to be changed, separated by '+'. This request takes in a JSON object with all the new values of the fields to be changed, and also the password for verification of the user.

**Note:** User is verified via a csrf-token or validation cookie.

```!POST /user/change/pass```

###### Arguments (JSON):
- ```oldpwd``` takes string(encr) value, and is checked first and then only any changes are made to the details.
- ```newpwd``` takes string(encr) value, represents the new password being passed.

**Note:** User is verified via a csrf-token or validation cookie.

---

### Relating to operations on bills
```!POST /user/presentbill``` presents a bill.

###### Arguments(JSON):
- ```no``` takes integer value
- ```name``` takes string value
- ```description``` takes string value
- ```party``` takes string value of presenting party
- ```supporting``` takes list\<string> value of supporting parties
- ```status``` takes enum<pending | accepted | rejected> value, defaults to pending.

Presenting party is automatically added as a supporting party, and members of supporting parties are automatically added as subscribers to the mailing list.

```!POST /startpoll``` starts a poll for a supplied bill number and changes the ```status``` of this bill object to `pending`. This also sends email to recipients. Only the presenter of a bill can start polling on it.

###### Arguments:
- ```bill``` takes integer value, represents bill number needs to be evaluated.

```!POST /user/poll``` votes on the poll. Dynamically generated by `/startpoll`.

###### Arguments:
- ```bill``` takes integer value, corresponds to bill_no in poll.
- ```vote``` takes boolean value, counts if voted true or false.

**Q:** How will authentication work in this case, since if it's a direct click from the mail application, the user won't be logged in to this portal.

**Note:** might have to modify data model again, because I'm realising that I'm storing the votes itself in no explicit place. (might convert ```subscribers``` to an array of objects where each object contains subscriber MLA Unique ID, and booleans ```voted``` and ```vote```). **Update:** these changes have been made.

```!POST user/subscribebill``` subscribe a user to a bill.

###### Arguments:
- ```bill``` takes integer value, represents the bill number to subscribe the current logged user to.

```!POST /evalpoll``` evaluates a poll. Only the presenter of a bill can evaluate the poll results on that bill.

###### Arguments:
- ```bill``` takes integer value, represents bill number needs to be evaluated.
